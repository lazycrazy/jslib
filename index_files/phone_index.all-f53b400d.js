/*!File[lib/RelSelect.js]*/
define("lib/RelSelect",["lib/EventObj"],function(t){var i={option:'<option value="#{value}" #{selected}>#{name}</option>'},e=function(t,i){return $.isString(t)&&$.isString(i)?{name:i,value:t}:$.isNumber(t)&&$.isString(i)?{name:i,value:i}:void 0},n=$.inherits(t,{constructor:function(i){t.call(this),this.containerNode=$(i.containerNode),this.dataParser=i.dataParser||e,this.selectName=i.selectName||"",this.emptyName=i.emptyName||!1,this.selectData=null,this.parent=null;var n=this;this.containerNode.delegate("select","change",function(){var t=this.value;n._fireValue(t)})},setData:function(t,e){this.selectData={};var n=['<select name="',this.selectName,'">'],o=this;this.emptyName&&n.push($.formatString(i.option,{name:o.emptyName})),$.each(t,function(t,r){var a=o.dataParser(t,r);o.selectData["v_"+a.value]=a.name,o.selectData["n_"+a.name]=a.value,n.push($.formatString(i.option,a,{selected:void 0!==e&&a.value==e?"selected":""}))}),n.push("</select>"),this.containerNode.html(n.join("")),this._fireValue(o.getValue())},setValue:function(t){this.containerNode.find("select").val(t),this._fireValue(t)},setName:function(t){var i=this.selectData["n_"+t];i&&this.setValue(i)},setParent:function(t,i){this.parent=t;var e=this;this.parent.on("valueChange",function(t){i.call(e,t)})},getValue:function(){return this.containerNode.find("select").val()},getName:function(){var t=this.getValue();return this.selectData["v_"+t]},isDataHasName:function(t){return this.selectData["n_"+t]},isDataHasValue:function(t){return this.selectData["v_"+t]},_fireValue:function(t){var i=this.selectData[t],e=this.containerNode.find("select")[0].selectedIndex;this.fire("valueChange",{name:i,value:t,selectedIndex:e})}});return n}),/*!File[lib/Performance.js]*/
define("lib/Performance",["lib/base"],function(t){var i={logid:SYS_CONF.logid,g_uniqid:t.safeGetProp(SYS_CONF,"userInfo.beeId")},e=window.SYS_PERFORMANCE?window.SYS_PERFORMANCE.headStart:!1,n=!1,o=function(){return 1*new Date},r=function(){if(window.performance&&$.isFunction(window.performance.getEntries))for(var t=0,e=window.performance.getEntries(),n=e.length;n>t;t++){var o,r=e[t],a=r.name,s=Math.round(r.duration),d=0==r.responseStart&&50>s;if(o=a.match(/beequick\.cn\/static\/.+\/([^\/]+\.(?:js|css))/)){var c=o[1].replace(/\-[0-9a-f]{8}/,"");i["r_"+c]=d?0:s}}},a=function(t,n){if(e&&window.performance&&window.performance.timing){var o=window.performance.timing,r=o.fetchStart,a=o[t],s=a-e,d=a==r?1:0;r&&a&&(i["t_"+t]=n&&d?0:s)}},s=function(){if(!e)return this;var t=window.SYS_PERFORMANCE.pageName,n=t.indexOf(".");return i.pageName=-1==n?t:t.substring(0,n),i.t_head=window.SYS_PERFORMANCE.bodyStart-e,window.SYS_PERFORMANCE.wxRedirectTime&&(i.t_wxRedirectTime=-window.SYS_PERFORMANCE.wxRedirectTime),$(d("ready",!0)),$(window).on("load",d("load",!0)),this},d=function(t,n){var r=function(){var n="t_"+t,r=o();return i[n]?this:(i[n]=r-e,void 0)};return n?r:(r(),this)},c=function(t,e){return i[t]?this:(i[t]=e,this)},u=function(){n||(n=!0,a("navigationStart"),a("domainLookupEnd",!0),a("connectEnd",!0),a("responseEnd"),r(),t.imgRequest(window.SYS_CONF.domain.clicklog+"/performance.gif?"+$.param(i)))};return{init:s,makeTime:d,addData:c,report:u}}),/*!File[common/weixinUtils.js]*/
define("common/weixinUtils",["lib/base","common/Share"],function(t,i){var e={shareMask:'<div id="mod-sharemask" class="mod-sharemask"></div>'},n=!1,o=$.noop,r=function(t){n||$(e.shareMask).appendTo("body").on($.tapClick,function(){$(this).css("display","none")}),n=!0,$("#mod-sharemask").css("display","block").css("background-color",t?"rgba(0,0,0,.45)":"transparent")},a=function(t){o=t},s=function(e){return function(){var n=o()||i.getWeixinDefaultShareObj();WeixinJSBridge.invoke(e,{appid:"wx1defa330695c1c56",img_url:n.imgUrl,link:t.urlAddParams(n.link,{tn:"wx_"+e}),title:n.title,desc:n.description},function(){})}},d=function(t){return function(){c(function(){WeixinJSBridge.call(t)})}},c=t.onceExecMulitCallFn(function(){var t=this;$(document).on("WeixinJSBridgeReady",function(){WeixinJSBridge.on("menu:share:appmessage",s("sendAppMessage")),WeixinJSBridge.on("menu:share:timeline",s("shareTimeline")),t.done()})});return{init:c,showToolbar:d("showToolbar"),hideToolbar:d("hideToolbar"),showOptionMenu:d("showOptionMenu"),hideOptionMenu:d("hideOptionMenu"),shareTip:r,setShareCallback:a}}),/*!File[common/Share.js]*/
define("common/Share",function(){return{getWeixinDefaultShareObj:function(){return{title:"馋了吗？找爱鲜蜂！",description:"馋了？忙呢？召唤鲜蜂侠，鲜果咖啡，坚果卤味，各种新鲜，闪电送达！",imgUrl:"http://weixin.beequick.cn/static/bee/img/icon_100-d49f76d5.png",link:"http://m.beequick.cn"}},getProductShareObj:function(t,i){return{title:"爱鲜蜂-各种新鲜闪电送达",description:"#爱鲜蜂# "+t.name,imgUrl:t.app_mimg,link:"http://m.beequick.cn/show/productDetail?id="+t.id+"&shopId="+i}},getOrderShareObj:function(t){return{title:"爱鲜蜂-各种新鲜闪电送达",description:"我在爱鲜蜂补充能量ing……这里各种新鲜全都有，你懂的，千万别来找我！",imgUrl:t.order_goods[0].app_mimg,link:"http://m.beequick.cn/show/share?key="+t.share_key}},getActiveShareObj:function(){}}}),/*!File[common/User.js]*/
define("common/User",["lib/base","lib/EventObj","common/Dialog"],function(t,i,e){var n=function(){var t,i=60,e=function(){i--,i&&setTimeout(e,1e3),t&&t(i)},n=function(n){t=n,i=60,e()};return n}(),o=$.inherits(i,{constructor:function(){i.call(this),this._isLogin=!!SYS_CONF.userInfo.authorized,this.phone=SYS_CONF.userInfo.phone,this.rawPhone=SYS_CONF.userInfo.rawPhone},isLogin:function(){return this._isLogin},getPhone:function(){return this.phone},getRawPhone:function(){return this.rawPhone},logout:function(i){var n=this;t.ajaxPost("/submit/logout",{},function(t){0==t.errno?(n._setLogin(!1),i&&i()):e.alert("退出失败："+t.errmsg)})},bindLogin:function(i,o){if(!i.data("bindLogin")){i.data("bindLogin","1");var r=this;!function(i){var a=function(t,n){i.find(".login-error-"+t).length?i.find(".login-error-"+t).html(n):n&&e.tip(n)},s=function(){var t=i.find(".login-input-phone").val(),e=/^1\d{10}$/.test(t);return e||a("phone","请输入正确的手机号"),e?t:!1},d=function(){var t=i.find(".login-input-code").val();return codeOk=/^\d{4,6}$/.test(t),codeOk||a("code","请输入验证码的数字"),codeOk?t:!1},c=function(t){t?i.find(".login-send").html(t+"s后重新发送").data("disabled","1").css("background-color","gray"):i.find(".login-send").html("获取验证码").data("disabled","").css("background-color","")},u=function(e,n){t.ajaxPost("/submit/sendVerifySMS",{phone:e,voice:n?1:0},function(t){t.data&&1==t.data.isvalid?(r._setLogin(!0),o&&o()):0==t.errno?(a("phone",n?"语音验证码已经拨打":"验证码已经发送"),n&&t.data.service&&i.find(".login-voice-wrap").html("电话拨打中，请留意来电："+t.data.service),i.find(".login-input-code")[0].focus()):a("phone",t.errmsg)})};i.find(".login-send").on($.tapClick,function(){if(!$(this).data("disabled")){var t;(t=s())&&(n(c),u(t))}}),i.find(".login-submit").on($.tapClick,function(){var i,e;(i=s())&&(e=d())&&t.ajaxPost("/submit/verify",{phone:i,code:e},function(t){0==t.errno||6201==t.errno?(r.rawPhone=i,r.phone=i.replace(/(\d{3})(\d{4})(\d{4})/,"$1***$3"),r._setLogin(!0),o&&o()):a("code",t.errmsg)})}),i.delegate(".login-voice-link",$.tapClick,function(){var t;(t=s())&&u(t,!0)})}($(i))}},_setLogin:function(t){this._isLogin=t,this.fire("statusChange")}}),r=null;return{getInstance:function(){return r||(r=new o),r}}}),/*!File[common/UserStatus.js]*/
define("common/UserStatus",function(){var t={longxiaAppGuide:0,geoGuide:1,cartGuide:2},i=null,e=!1,n=function(){if(!e){e=!0,i=[];for(var t=$.getCookie("beeus")||"",n=0;10>n;n++)i[n]=t.charAt(n)||0}},o=function(e){if(n(),void 0!==t[e]){var o=i[t[e]];return parseInt(o)==o?parseInt(o):o}return!1},r=function(e,o){if(n(),o+="",0==o.length)o="0";else if(1!==o.length)throw new Error("status value error");return void 0!==t[e]&&(i[t[e]]=o,$.setCookie("beeus",i.join(""),{path:"/",expires:31104e6})),!1},a=function(t){var i=o(t);return i===!1?!1:0==i?(r(t,1),!0):!1};return{isFirst:a}}),/*!File[common/AreaInfo.js]*/
define("common/AreaInfo",function(){var t=[{id:3,name:"东城区"},{id:4,name:"西城区"},{id:7,name:"朝阳区"},{id:8,name:"丰台区"},{id:9,name:"石景山区"},{id:10,name:"海淀区"},{id:11,name:"门头沟区"},{id:12,name:"房山区"},{id:13,name:"通州区"},{id:14,name:"顺义区"},{id:15,name:"昌平区"},{id:16,name:"大兴区"},{id:17,name:"怀柔区"},{id:18,name:"平谷区"},{id:19,name:"密云区"}],i=[{id:23,name:"黄浦区"},{id:24,name:"卢湾区"},{id:25,name:"徐汇区"},{id:26,name:"长宁区"},{id:27,name:"静安区"},{id:28,name:"普陀区"},{id:29,name:"闸北区"},{id:30,name:"虹口区"},{id:31,name:"杨浦区"},{id:32,name:"闵行区"},{id:33,name:"宝山区"},{id:34,name:"嘉定区"},{id:35,name:"浦东新区"},{id:36,name:"金山区"},{id:37,name:"松江区"},{id:38,name:"青浦区"},{id:39,name:"南汇区"},{id:40,name:"奉贤区"},{id:41,name:"崇明县"}],e=[{id:425,name:"东山区"},{id:426,name:"荔湾区"},{id:427,name:"越秀区"},{id:428,name:"海珠区"},{id:429,name:"天河区"},{id:430,name:"芳村区"},{id:431,name:"白云区"},{id:432,name:"黄埔区"},{id:433,name:"番禺区"},{id:434,name:"花都区"},{id:435,name:"增城区"},{id:436,name:"从化区"}],n=[{id:525,name:"罗湖区"},{id:526,name:"福田区"},{id:527,name:"南山区"},{id:528,name:"宝安区"},{id:529,name:"龙岗区"},{id:530,name:"盐田区"}];return[{id:2,name:"北京市",districts:t,provinceName:"北京",provinceId:1},{id:22,name:"上海市",districts:i,provinceName:"上海",provinceId:21},{id:424,name:"广州市",districts:e,provinceName:"广东",provinceId:423},{id:524,name:"深圳市",districts:n,provinceName:"广东",provinceId:423}]}),/*!File[common/Promotion.js]*/
define("common/Promotion",["lib/base","common/Dialog"],function(t,i){var e=function(i){this.shoppingCart=i,this.promotion=SYS_CONF.promotion,this.checkMethodList="productExclusion,countLimit,brandExclusion,number,productAppGuide".split(","),this.defaultMinPrice=parseInt(t.safeGetProp(SYS_CONF,"promotion.shoppingCart.minPrice")||30),this.defaultPropText=this.propText=this.getIsStart("wxFanxian")&&($.isWeixin||$.isApp)?"微信支付每日首单返5元":"购物满￥100，免配送费"};return e.prototype={setShopData:function(){this.propText=this.defaultPropText},getPropText:function(){return this.propText},checkShoppingCartError:function(t){return this._doCheck(this.checkMethodList,t)},getIsStart:function(t){return this.promotion.timestart&&this.promotion.timestart[t]?this.promotion.timestart[t].isStart:!1},getStartConf:function(t){return this.promotion.timestart&&this.promotion.timestart[t]?this.promotion.timestart[t]:null},getMinPrice:function(){var t,i=this.defaultMinPrice,e=this.shoppingCart.getShoppingMap(),n=SYS_CONF.promotion.minPrice;if(n)for(var o in e)n.hasOwnProperty(o)&&(t=parseInt(n[o]),i=Math.min(i,t));return i},_doCheck:function(t,i){for(var e,n=this.shoppingCart.getShoppingMap(),o=0,r=t.length;r>o;o++){e=t[o];var a=this["_check_"+e](i,n);if(a)return a}return!1},_check_productExclusion:function(i,e){var n=t.safeGetProp(this.promotion,"exclusion.id");if($.isArray(n))for(var o=0,r=n.length;r>o;o++){for(var a,s=n[o].split(","),d=0,c=s.length;c>d&&(s[d]==i.id||!(a=e[s[d]]));d++);if(a&&$.isInArray(s,i.id))return a.name+" 和\n"+i.name+"\n不能同时购买哦~"}},_check_brandExclusion:function(i,e){var n=t.safeGetProp(this.promotion,"exclusion.brand");if($.isArray(n)){var o={};for(var r in e){var a=e[r];o[a.brand_id]=a.brand_name}for(var s=0,d=n.length;d>s;s++){var c=n[s].split(",");if(!$.isInArray(c,i.brand_id))return!1;for(var u=0,p=c.length;p>u;u++){var l=c[u];if(l!=i.brand_id&&o[l])return i.brand_name+" 和 "+o[l]+"\n需要在两个订单中购买哦~"}}}},_check_countLimit:function(t,i){var e,n,o=this.promotion.countLimit,r=t.id;if(o)return(e=parseInt(o[r]))&&(n=i[r]?i[r].shoppingCount:0,n>=e)?t.name+"\n最多只能购买"+e+"个哦~":void 0},_check_number:function(t){return parseInt(t.number)<1&&!parseInt(t.hot_degree)?t.name+" 补货中..\n过段时间再来看看吧~":void 0},_check_productAppGuide:function(t){var e;if($.isMobile&&!$.isApp&&(e=Bee.getMod("common/UserStatus",!0))&&2581==t.id){var n="longxiaAppGuide";if(!e.isFirst(n))return;i.show({content:"App购买龙虾可以享受五折优惠哦~",buttons:[{key:"continue",autoClose:!0,text:"继续购物"},{key:"goto",text:"下载App",autoClose:!0,onClick:function(){window.location.href="http://m.beequick.cn/show/appDownload?tn="+n}}]})}}},e}),/*!File[common/ShoppingCart.js]*/
define("common/ShoppingCart",["lib/EventObj","lib/Storage","common/Promotion"],function(t,i,e){var n=function(t){return parseFloat(Math.round(10*t)/10)},o=window.SYS_CONF.promotion.shoppingCart||{},r=$.inherits(t,{constructor:function(n){t.call(this),n=$.extend({minPrice:!1},n),this.storage=new i("shoppingcart"),this.shoppingList=this.storage.get("shoppingList")||{},this.promotion=new e(this),this.minPrice=this.promotion.getMinPrice(),this.productMap={},this.cartInfoObj={},this._calcCartInfo();var o=Bee.getMod("common/Dialog",!0);this.alert=o?function(t){o.alert(t.replace(/\n/g,"<br/>"))}:$.noop,this._lastOpInfo={opSuccess:!0,opErrorMsg:""}},addProduct:function(t){var i,e;if($.isString(t)||$.isNumber(t)){if(i=t,null==this.productMap&&!this.shoppingList[t])return this._error("need setData before"),void 0;if(!this.shoppingList[t]&&!this.productMap[i])return this._error("id "+i+" 不存在"),void 0}$.isObject(t)&&(i=t.id,this.productMap[i]||(this.productMap[i]=t)),e=this.productMap[i]||this.shoppingList[i];var n=this.promotion.checkShoppingCartError(e);return n?(this._error(n),void 0):(this.shoppingList[i]||(this.shoppingList[i]=e,e.shoppingCount=0),this.shoppingList[i].shoppingCount++,this._fireChange("add"),void 0)},deleteProduct:function(t,i){var e;if($.isString(t)||$.isNumber(t)){if(e=t,null==this.productMap&&!this.shoppingList[e])return this._error("need setData before"),!1}else e=t.id;return this.shoppingList[e]||this.productMap[e]?(i?this.shoppingList[e].shoppingCount=0:this.shoppingList[e].shoppingCount--,this.shoppingList[e].shoppingCount<1&&delete this.shoppingList[e],this._fireChange("del"),!0):!1},addProductDataList:function(t){var i=this,e=function(t){$.each(t,function(t,e){e.price=parseFloat(e.price)||0,i.productMap[e.id]=e})};$.isArray(t)?e(t):$.each(t,function(t,i){parseInt(t)<=0||e(i)})},setProductList:function(t){var i=this,e={},n=[];return this.productMap={},this.promotion.propText="购物满￥100，免配送费",$.each(t,function(t,e){parseInt(t)<=0||$.each(e,function(t,e){524==e.cityid&&(i.promotion.propText="闪电送，免运费"),e.price=parseFloat(e.price)||0,i.productMap[e.id]=e})}),$.each(this.shoppingList,function(t,o){var r=null;if(r=i.productMap[t]){if(!parseInt(r.number)&&!parseInt(r.hot_degree))return n.push(r),void 0;e[t]=r,r.shoppingCount=o.shoppingCount}else n.push(o)}),this.shoppingList=e,this._fireChange("data"),n.length&&this.fire("unableAutoRemoved",{unableList:n}),this},setDisableProducts:function(t){$.isString(t)&&(t=t.split(","));for(var i=0,e=t.length;e>i;i++){var n=t[i];this.shoppingList[n]&&(this.shoppingList[n].disabled=!0)}this._fireChange("data")},setShopData:function(t){this.promotion.setShopData(t),this._fireChange("data")},removeDisabledProduct:function(){var t=this;$.each(this.shoppingList,function(i,e){e.disabled&&(delete e.disabled,delete t.shoppingList[i],t.productMap&&t.productMap[i]&&t.productMap[i].disabled&&delete t.productMap[i].disabled)}),this._fireChange("data")},getShoppingList:function(){var t=[];for(var i in this.shoppingList)t.push(this.shoppingList[i]);return t},getShoppingMap:function(){return this.shoppingList},getProductById:function(t){return this.shoppingList[t]||null},getProductObjById:function(t){return this.productMap[t]},getGroupCountBy:function(t){var i={};return $.each(this.shoppingList,function(e,n){if(!n.disabled){var o=n[t];i[o]=i[o]||0,i[o]+=n.shoppingCount}}),i},getIdformat:function(){var t=[];for(var i in this.shoppingList)t.push(i+":"+this.shoppingList[i].shoppingCount);return t.join(",")},getCount:function(){return this.cartInfoObj.count},getTotalPrice:function(){return this.cartInfoObj.price},check:function(){if($.isNumber(this.minPrice)){var t=this.getTotalPrice();return t>=this.minPrice?!1:"差￥"+(this.minPrice-t)+"起送"}return!1},reset:function(){return this.shoppingList={},this._fireChange("reset"),this},delegateOperate:function(t){var i=this;return $(t).delegate(".shopping-action",$.tapClick,function(t){t.stopPropagation();var e=$(this).data("action");if(e){var n=e.split(":"),o=n[0],r=n[1];"+"==r?i.addProduct(o):"-"==r&&i.deleteProduct(o)}}),$(t).delegate(".shopping-item","swipeLeft",function(){var t=$(this),e=t.data("id"),n=t.data("anime");if(e){var o=function(){i.deleteProduct(e,!0)};n?t.animate({translateX:"-100%",scale:".3"},200,"ease-out",o):o()}}),this},bindBarUi:function(t,i){var e=this;return i=i||"选好了",this.on("shoppingListChange",function(){e._updateUi(t,i)}),this._updateUi(t,i),this},getCartInfo:function(){return this.cartInfoObj},_calcCartInfo:function(){var t=0,i=0,e=!1,o="",r=(this.shoppingList,this.minPrice);$.each(this.shoppingList,function(e,n){n.disabled||(t+=n.shoppingCount||0,i+=(parseFloat(n.price)||0)*n.shoppingCount)}),i=n(i),e=i>=r,o=e?"选好了":0==i?"满￥"+this.minPrice+"起送":"差￥"+n(this.minPrice-i)+"起送";var a=this;this.cartInfoObj={isOk:e,payType:2,price:i,count:t,minPrice:r,priceText:"共￥"+i,btnText:o,propText:a.promotion.getPropText(),emptyText:"购物车是空的",shoppingList:a.getShoppingList()}},_updateUi:function(t,i){var e=this.getCartInfo(),n=e.count,o=e.isOk;t[n?"removeClass":"addClass"]("shopping-empty"),t.find(".shopping-count").html(n).css("visibility",n?"visible":"hidden").addClass("erect"),setTimeout(function(){t.find(".shopping-count").removeClass("erect")},150),t.find(".shopping-total").html(n?e.priceText:e.emptyText),t.find(".shopping-words").html(e.propText),t.find(".shopping-submit-text").html(o?i:e.btnText),t.find(".shopping-submit").attr("disabled",!o)[o?"addClass":"removeClass"]("shopping-enable")},_fireChange:function(t){this.minPrice=this.promotion.getMinPrice(),this._calcCartInfo(),this.fire("shoppingListChange",$.extend({reason:t},this.cartInfoObj)),this.storage.set("shoppingList",this.shoppingList)},_error:function(t){this._lastOpInfo={opSuccess:!1,opErrorMsg:t},this.alert(t)},getLastError:function(){var t=this._lastOpInfo;return this._lastOpInfo={opSuccess:!0,opErrorMsg:""},t}});return new r({minPrice:parseInt(o.minPrice||50)})}),/*!File[common/BaseAddrManager.js]*/
define("common/BaseAddrManager",["lib/base","lib/EventObj","common/AreaInfo","lib/Storage"],function(t,i,e){var n=function(t){this.id=t.id||!1,this._setProp(t)};return n.prototype={_setProp:function(t){this.phone=t.telphone||t.phone||this.phone||"",this.name=t.accept_name||t.name||this.name||"",this.address=t.address||this.address||"",this.cityId=t.cityId||t.city_id||this.cityId||"",this.districtId=t.districtId||t.district_id||this.districtId||"",this.provinceId=t.provinceId||t.province_id||this.provinceId||"",this.longitude=t.lng||!1,this.latitude=t.lat||!1},getId:function(){return this.id},getName:function(){return this.name},getPhone:function(){return this.phone},getCityName:function(){return BaseAddrManager.getCityNameById(this.cityId)},getDistrictName:function(){return BaseAddrManager.getDistrictNameById(this.cityId,this.districtId)},getFullAddress:function(){return this.getCityName()+this.getDistrictName()+this.address},update:function(t){this._setProp(t)},toObject:function(){var t={};for(var i in this)this.hasOwnProperty(i)&&(t[i]=this[i]);return t}},BaseAddrManager=$.inherits(i,{constructor:function(){i.call(this),this.addrObjs={},this._likelyAddrIdMap={},this._inited=!1,this.lastAddrId=!1,window.SYS_CONF&&window.SYS_CONF.addrList&&this._init(window.SYS_CONF.addrList)},init:function(i){if(this._inited)return i&&i(),void 0;var e=this;t.ajaxPost("/submit/getAddrList",{},function(t){0==t.errno?(e._init(t.data,!0),i&&i(),e.fire("addrListAsyncInitd")):e.fire("addrError",{errmsg:t.errmsg})})},_init:function(t){var i=this;$.each(t,function(t,e){i.addrObjs[e.id]=new n(e)}),this._inited=!0,this.fire("addrListChange")},isInited:function(){return this._inited},addNewAddr:function(i,e){var o=this;t.ajaxPost("/submit/updateAddr",i,function(t){if(0==t.errno){var r=t.data.id;i.id=r;var a=new n(i);o.addrObjs[r]=a,o.fire("addrListChange"),e&&e(a)}else o.fire("addrError",{errmsg:"添加失败:"+t.errmsg})})},updateAddr:function(i,e,n){var o=this,r=o.addrObjs[i];if(!r)return o.fire("addrError",{errmsg:"更新失败:id不存在"}),void 0;var a=$.extend(r.toObject(),e);t.ajaxPost("/submit/updateAddr",a,function(t){0==t.errno?(r.update(e),o.fire("addrListChange"),n&&n(r)):o.fire("addrError",{errmsg:"更新失败:"+t.errmsg})})},delAddr:function(i,e){var n=this,o=n.addrObjs[i];o||this.fire("addrError",{errmsg:"删除失败:id不存在"}),t.ajaxPost("/submit/deleteAddr",{id:i},function(t){0==t.errno?(delete n.addrObjs[i],n.fire("addrListChange"),e&&e(o)):(e&&e(!1),this.fire("addrError",{errmsg:"删除失败:"+t.errmsg}))})},getAddrByConfig:function(t){var i=0;for(var e in this.addrObjs){var n=this.addrObjs[e];n.cityId==t.cityId&&n.districtId==t.districtId&&$.trim(n.address)==$.trim(t.address)&&i<parseInt(e)&&(i=parseInt(e))}return 0==i?!1:this.addrObjs[i]},setLastAddrId:function(t){if(this.addrObjs[t]){var i=this;this.lastAddrId=t,this.fire("lastAddrChange",{addrId:t,addrObj:i.addrObjs[t]})}},getLastAddr:function(){var t=null;return this.lastAddrId&&(t=this.addrObjs[this.lastAddrId])?t:!1},getAddrById:function(t){return this.addrObjs[t]||!1},getAddrList:function(){var t=[];for(var i in this.addrObjs)t.push(this.addrObjs[i]);return t},getAddrCount:function(){var t=0;for(var i in this.addrObjs)t++;return t}}),BaseAddrManager.getCityNameById=function(t){var i="";return $.each(e,function(e,n){return n.id==t?(i=n.name,!1):void 0}),i},BaseAddrManager.getCityIdByName=function(t){var i="";return $.each(e,function(e,n){return n.name==t?(i=n.id,!1):void 0}),i},BaseAddrManager.getDistrictNameById=function(t,i){for(var n=0,o=e.length;o>n;n++){var r=e[n];if(r.id==t)for(var a=0,s=r.districts.length;s>a;a++){var d=r.districts[a];if(d.id==i)return d.name}}return""},BaseAddrManager.getDistrictIdByName=function(t,i){for(var n=0,o=e.length;o>n;n++){var r=e[n];if(r.name==t)for(var a=0,s=r.districts.length;s>a;a++){var d=r.districts[a];if(d.name==i)return d.id}}return""},BaseAddrManager.AddrObj=n,BaseAddrManager}),/*!File[common/AddrManager.js]*/
define("common/AddrManager",["lib/base","lib/GeoLocation","common/BaseAddrManager"],function(t,i,e){var n=!1,o=$.inherits(e,{constructor:function(){e.call(this),this.shopData=null,this.tempAddr=!1,this._loadingAddrObj=!1;var t=this;this.on("lastAddrChange",function(i){t.loadShopCategory(i.addrObj)}),this.on("addrListAsyncInitd",function(){t._fireUserAddrDecided(this._loadingAddrObj)})},setTempAddr:function(t){this.tempAddr=new e.AddrObj(t),this.loadShopCategory(this.tempAddr)},getTempAddr:function(){return this.tempAddr},initGPS:function(){var e=this;this.fire("progressing",{status:"gps",text:"定位中"}),i.getGPSPosition(function(i){if(i.success){var o={type:"gps",longitude:i.longitude,latitude:i.latitude};e.fire("gpsSuccess",o),e.loadShopCategory(o),e._parseGpsAddr(o)}else e.fire("gpsError",{error:i.error});if(SYS_CONF.sns.userId&&!n){n=!0;var r={ASID:t.getAsId(),LAT:i.latitude||-1,LNG:i.longitude||-1,OPENID:SYS_CONF.sns.userId,GEOLOGID:$.getCookie("geologid")};t.imgRequest("http://as.beequick.cn/report?"+$.param(r))}})},_parseGpsAddr:function(i){this.fire("progressing",{status:"parsing",text:"解析中"});var e=this;t.getAddressInfoByPoint(i.latitude,i.longitude,function(t){t?e.fire("gpsParsed",t):e.fire("gpsParsedError")})},loadShopCategory:function(i){t.getGeoLogid(),this._loadingAddrObj=i;var e=this;e.fire("progressing",{status:"loading",text:"加载中"}),t.ajaxGet("/data/getCategoryListByLbs","gps"==i.type?{lat:i.latitude,lng:i.longitude,childmode:1}:{address:i.getFullAddress(),childmode:1},function(t){if(0==t.errno){var n=t.data;e.shopData=n,e._likelyAddrIdMap={},e.fire("addrChange",{data:t.data,userAddr:i}),e._fireUserAddrDecided(i)}else e.fire("addrChangeError",t)})},getShopData:function(){return this.shopData},isGpsAddr:function(){return this._loadingAddrObj&&"gps"==this._loadingAddrObj.type},_addrListChange:function(){this.storage.set("addrObjs",this.addrObjs),this.fire("addrListChange")},_fireUserAddrDecided:function(i){if(0==this.getAddrCount())return this.lastAddrId=!1,this.fire("userAddrDecided"),void 0;var e,n={},o=this;return(e=i.id)?(this.lastAddrId=this.addrObjs[e]?e:!1,this.fire("userAddrDecided"),void 0):("gps"==i.type?n.location=i.longitude+","+i.latitude:n.address=i.getFullAddress(),t.ajaxPost("/submit/getMostLikelyAddr",n,function(t){if(o.lastAddrId=!1,0==t.errno){var i=t.data.id,e=o.getAddrById(i);e&&(o.lastAddrId=i)}o.fire("userAddrDecided")}),void 0)}});return o}),/*!File[common/Pay.js]*/
define("common/Pay",["lib/base","lib/EventObj"],function(t,i){var e=$.inherits(i,{constructor:function(t,e){i.call(this),this.key=t,this.name=e.name,this.weight=e.weight,this.onPayFn=e.onPayFn,this.checkSupport=e.checkSupport,this.typeid=e.typeid},pay:function(t,i,e){this.onSuccess=i,this.onError=e,this.onPayFn(t)},getPayType:function(){return"delivery"==this.key?o.PAYTYPE_DELIVERY:o.PAYTYPE_ONLINE},_success:function(){this.onSuccess&&this.onSuccess()},_error:function(t){this.onError&&this.onError(t)}}),n={},o={PAYTYPE_DELIVERY:0,PAYTYPE_ONLINE:1,create:function(t,i){n[t]=new e(t,i)},get:function(t){return n[t]},getSupportPays:function(t){var i=[];for(var e in n){var o=n[e];o.checkSupport()&&("number"==typeof t?t===o.getPayType()&&i.push(o):i.push(o))}return i.sort(function(t,i){return i.weight-t.weight}),i}};return o.create("delivery",{name:"货到付款",weight:100,typeid:0,checkSupport:function(){return"cmbc"!=SYS_CONF.tn},onPayFn:function(){this._success()}}),o.create("cmbc",{name:"民生银行支付",weight:200,checkSupport:function(){return"cmbc"==SYS_CONF.tn},onPayFn:function(t){var i='<form id="mod-pay-cmbcform" action="http://180.150.179.29/cmbc/api/thirdpart" method=\'POST\'>\n<input type="hidden" name="orderMsg" value="#{orderDetail}"/>\n<input type="hidden" name="successPage" value="#{host}/show/payResult" />\n<input type="hidden" name="uid" value="#{uid}" />\n<input type="hidden" name="sign" value="#{sign}" />\n</form>',e="#{name},#{price},#{shopCount},#{total}",n=[t.order_no,t.create_time,t.order_amount,"beequick.cn",{toString:function(){var i=[];return $.each(t.order_goods,function(t,n){i.push($.formatString(e,{name:n.name,price:parseFloat(n.real_price),shopCount:n.goods_nums,total:parseFloat(n.real_price)*n.goods_nums}))}),i.join(";")}}],o=$("#mod-pay-cmbcform");o.length||($($.formatString(i,{orderDetail:n.join("|"),uid:$.getParam("uid")||"",sign:$.getParam("sign")||"",host:SYS_CONF.domain.current})).appendTo(document.body),o=$("#mod-pay-cmbcform")),o[0].submit()}}),o.create("weixin",{name:"微信支付",weight:150,typeid:1,checkSupport:function(){return $.isWeixin&&SYS_CONF.domain.current.indexOf("weixin")>0},onPayFn:function(i){var e=this,n=function(){t.ajaxPost("/submit/weixinPayinfo",{orderId:i.id||i.order_id,orderNo:i.order_no},function(t){if(0==t.errno){var i=t.data;WeixinJSBridge.invoke("getBrandWCPayRequest",i,function(t){var i=t.err_msg;"get_brand_wcpay_request:ok"==i?e._success():"get_brand_wcpay_request:cancel"==i?e._error("支付被取消"):e._error(i)})}else e._error("创建支付失败："+t.errmsg)})};window.WeixinJSBridge?n():$(document).on("WeixinJSBridgeReady",n)}}),o.create("weibo",{name:"支付宝支付",weight:150,typeid:2,checkSupport:function(){if(-1==SYS_CONF.domain.current.indexOf("weibo"))return!1;var t=navigator.userAgent.match(/__weibo__([\d\.]+)/im);if(t){var i=parseFloat(t[1]);if(i>=4.3)return!0}return!1},onPayFn:function(i){var e=this;t.ajaxPost("/submit/weiboPayinfo",{orderId:i.id||i.order_id,orderNo:i.order_no,showUrl:SYS_CONF.domain.current+"/show/orderlist"},function(t){if(0==t.errno){var i=t.data;window.location.href="http://weibo.cn/weibobrowser/payment/order?"+$.param(i)}else e._error("创建支付失败："+t.errmsg)})}}),o}),/*!File[activity/bridge.js]*/
define("activity/bridge",function(){var t,i={setInitHandler:function(i){t=i},activityLoaded:function(i,e){this.curActivityId=i,t&&t(i,e)},share:$.noop,addProduct:$.noop,verify:$.noop,reload:$.noop,getEnv:$.noop},e=Bee.getMod("activity/bridge_"+($.isApp?"app":$.isMobile?"mobile":"www"));return $.extend(i,e)}),/*!File[activity/bridge_mobile.js]*/
define("activity/bridge_mobile",["common/Dialog","common/weixinUtils","common/User","phone/index/main","phone/common/PageView"],function(t,i,e,n,o){return{share:function(){$.isWeixin?i.shareTip(!0):$.isWeibo||$.isMobile&&t.alert("移动端暂时不支持分享")},addProduct:function(t){n.getShoppingCart().addProduct(t)},verify:function(i){var e=function(){o.changeView("verify",[function(){o.changeView("activity")},"activity"])};i?t.alert(i,e):e()},reload:function(){var t=o.getCurViewObj();t&&t.load&&t.load()}}}),/*!File[phone/common/PageView.js]*/
define("phone/common/PageView",["lib/Loading","phone/common/Overlay","phone/common/baseCtxPrototype"],function(t,i,e){var n=function(t){this.key=t,this.viewObj=null,this.containerNode=$("#mod-"+this.key),this._iScrollInstances={},this.firstEnter=!0,this._hidingTask=[]};n.prototype={g:function(t){return $("#"+this.key+"-"+t)},isCurrentView:function(){return this.key==r},isFirstEnter:function(){return this.firstEnter},changeView:function(t){for(var i=[],e=1,n=arguments.length;n>e;e++)i.push(arguments[e]);return s(t,i)},viewBack:function(){if(this.viewObj&&this.viewObj.back){var t,i=this.viewObj.back();t=$.isString(i)?u(i):i,s(t.pageView||"index",t.args||[])}},showOverlay:function(t){for(var e=[],n=1,o=arguments.length;o>n;n++)e.push(arguments[n]);i.showOverlay(t,this,e)},hideOverlay:function(){i.hideOverlay()},setTitle:function(t){this.find(".header-content").html(t)},whenShowingDo:function(t){this.isCurrentView()?t.call(this):this._hidingTask.push(t)},_executeHidingTask:function(){var t,i;if(i=this._hidingTask.length){for(t=0;i>t;t++)this._hidingTask[t].call(this);this._hidingTask=[]}},blurInput:function(){this.find("input,textarea").each(function(t,i){i.blur()})},init:function(t){this.viewObj=t,this._initIscroll();var i=this;this.delegate(".tap-action",$.tapClick,function(t){var e=$(this).attr("disabled");if(""!==e&&"true"!==e){var n=$(this).data("tap"),o=n.split("|"),r=o[0],a=o[1]||"";"!back"==r?i.viewBack():$.isFunction(i.viewObj[r])&&i.viewObj[r].apply(i.viewObj,a.split(",")),t.stopPropagation()}}),$.isFunction(this.viewObj.fixIOS70Input)&&$.isApple&&navigator.userAgent.match(/7_0(?:_\d)?/)&&this.delegate("input",$.tapClick,function(){var t=this;switch(t.type){case"text":case"number":case"tel":i.viewObj.fixIOS70Input.call(i.viewObj,t),setTimeout(function(){t.focus()},800)}})}},$.extend(n.prototype,e);var o={},r=null,a=function(t,i){var e=new n(t),r=i(e);r._ctx=e,o[t]=r,r&&r.init&&r.init(),e.init(r)},s=function(t,i){var e=null;if(r!=t){e=o[r],e&&(e._ctx.blurInput(),e.onleave&&e.onleave()),$("#mod-container .pageview").css("display","none"),$("#mod-"+t).css("display","block"),r=t,e=o[r],e._ctx._executeHidingTask(),e.onenter&&e.onenter.apply(e,i),e._ctx.firstEnter=!1;var n=[];if(i)for(var a=0,s=i.length;s>a;a++){var d=i[a];"function"==typeof d?n.push(null):n.push(d)}if(history.replaceState)try{history.replaceState({pageView:r,args:n})}catch(c){}document.body.className="pv-"+t,window.scrollTo(0,0)}},d=function(){var t=c()||u()||{};s(t.pageView||"index",t.args||[]),window.onpopstate=function(){var t=c();t&&s(t.pageView,t.args)}},c=function(){if(history.state){var t=history.state;return{pageView:t.pageView,args:t.args}}return!1},u=function(t){t=t||$.getParam("pv","index");var i=t.match(/(\w+)(?:\|([,\w]+))?/),e=[];return i[2]&&$.each(i[2].split(","),function(t,i){"true"==i?e.push(!0):"false"==i?e.push(!1):parseFloat(i)==i?e.push(parseFloat(i)):e.push(i)}),i?{pageView:i[1],args:e}:!1};return{defineView:a,changeView:s,getCurViewName:function(){return r},getCurViewObj:function(){return o[r]},init:d}}),/*!File[phone/common/Overlay.js]*/
define("phone/common/Overlay",["phone/common/baseCtxPrototype"],function(t){var i=function(t){this.overlayId=t,this.containerNode=$("#mod-overlay-"+t),this._iScrollInstances={},this._isShowing=!1};i.prototype={init:function(){this._initIscroll(),this.delegate(".tap-action",$.tapClick,function(t){var i=$(this).attr("disabled");if(""!==i&&"true"!==i){var e=$(this).data("tap"),o=e.split("|"),r=o[0],a=o[1]||"";$.isFunction(n[r])&&n[r].apply(n,a.split(",")),t.stopPropagation()}})},hideLayer:function(){$("#mod-overlay-"+this.overlayId).css("display","none")},goBack:function(){$("#mod-overlay-mask").css("display","none"),this.curPageViewCtx.removeClass("overlaied overlaied-"+this.overlayId),this._isShowing=!1},hide:function(){a()},isShowing:function(){return this._isShowing}},$.extend(i.prototype,t);var e={},n=null,o=function(t,n){var o=new i(t),r=n(o);o.init(),r._ctx=o,r.init&&r.init(),e[t]=r},r=function(t,i,o){if(!n){n=e[t],n._ctx.curPageViewCtx=i,i.addClass("overlaied overlaied-"+t),$("#mod-overlay-mask").css("display","block");var r=function(t){t.target==this&&(a(),$(this).off($.tapClick,arguments.callee))};$("#mod-overlay-"+t).css("display","block").on($.tapClick,r),setTimeout(function(){n.show&&n.show.apply(n,o),n._ctx._isShowing=!0},30)}},a=function(){n&&n._ctx.isShowing()&&n.hide(),n=null};return{defineOverlay:o,showOverlay:r,hideOverlay:a,getCurOverlayObj:function(){return n}}}),/*!File[phone/common/baseCtxPrototype.js]*/
define("phone/common/baseCtxPrototype",["lib/Loading"],function(t){var i=0,e=function(t){return function(){return this.containerNode[t].apply(this.containerNode,arguments)}},n={onScrollStart:function(){for(var t=this.scroller,i=t.className;t&&-1==i.indexOf("pageview")&&-1==i.indexOf("mod-overlay");)t.scrollTop=0,t=t.parentElement,i=t.className}},o={find:e("find"),addClass:e("addClass"),removeClass:e("removeClass"),on:e("on"),delegate:e("delegate"),showLoading:t.show,hideLoading:t.hide,refreshIscroll:function(t,i){"boolean"==typeof t&&(i=t,t=void 0),$.each(this._iScrollInstances,function(e,n){t&&e!=t||($.isMobile?(n.refresh(),i&&n.scrollTo(0,0,0)):i&&(n.scrollTop=0))})},getIscrollById:function(t){return this._iScrollInstances[t]},scrollToElement:function(t,i,e){var n=this._iScrollInstances[t];if($.isMobile)n.scrollToElement(i,e);else{var o=iScroll.prototype,r=o._offset(n),a=o._offset(i),s=r.top-a.top;n.scrollTop=s}},_initIscroll:function(){var t=this;t.find(".iscroll-container").each(function(e,o){var r=$(o).data("iscroll-id")||++i;if($.isMobile){var a={hScroll:!1},s=$(o),d="onRefresh,onScrollStart,onScrollMove,onScrollEnd,onTouchEnd".split(",");s.data("iscroll-nobounce")&&(a.bounce=!1);for(var c=0,u=d.length;u>c;c++){var p=d[c],l=p.toLowerCase(),h=s.data(l);h&&t.viewObj[h]?a[p]=function(i,e){return function(){n[e]&&n[e].call(this),t.viewObj[i](this)}}(h,p):n[p]&&(a[p]=n[p])}t._iScrollInstances[r]=new iScroll(o,a)}else $(o).css("overflow","auto"),t._iScrollInstances[r]=o;$(o).data("iscroll-id",r)})}};return o}),/*!File[phone/index/ProductView.js]*/
define("phone/index/ProductView",["lib/base","phone/index/main","common/Dialog"],function(t,i){var e={productItem:'<li id="#{viewName}-product-#{id}" class="product-item shopping-item" data-id="#{id}">\n<div class="product-imgwrap tap-action  #{productZero} #{productRestock}" data-tap="showDetail|#{id},#{shopId},#{isRestock}">\n<div id="#{viewName}-product-img-#{idx}" class="product-img#{productImgEmpty}" #{productImg} data-idx="#{idx}"></div>\n<span class="product-restock-img"></span>\n<span class="product-maskblock product-count">#{count}</span>\n<span class="product-maskblock product-add shopping-action" data-action="#{id}:+">﹢</span>\n<span class="product-maskblock product-del shopping-action" data-action="#{id}:-">﹣</span>\n</div>\n<h6 class="product-name ui-ellipsis">#{name}</h6>\n<p class="product-detail">\n<span class="product-detail-price">￥#{price}</span>\n<span class="product-detail-marketprice">#{marketPrice}</span>\n&nbsp;\n<span class="product-detail-attribute">#{attributeStr}</span>\n</p>\n</li>',tagItem:'<li class="tag-item tap-action" data-tap="#{method}|#{shopId},#{id},#{name},#{img}" style="background-image:url(#{img})"></li>',dynaStyleTpl:".mod-#{viewName} .product-imgwrap { height: #{imgHeight}px; }\n.mod-#{viewName} .product-add { width:#{buttonWidth}px; height:#{buttonHeight}px; line-height:#{buttonHeight}px;}\n.mod-#{viewName} .product-del { top:#{buttonHeight}px;width:#{buttonWidth}px; height:#{buttonHeight}px; line-height:#{buttonHeight}px;}\n.mod-#{viewName} .product-count { right:#{countRight}px; line-height:#{imgHeight}px; width:#{countWidth}px;}\n.mod-#{viewName} .tag-item { height:#{tagHeight}px;}"},n=i.getShoppingCart(),o=function(t,i,e){this.viewName=t,this.shopId=i,this.listContainerNode=e,this.productHeight=0};return o.prototype={getProductItemHtml:function(t,o){var r=o.id,a=n.getProductById(r),s=this;return $.formatString(e.productItem,o,{productZero:a?"":"product-zero",productRestock:i.isProductRestock(o)?"product-restock":"",productImg:o.app_img?'data-url="'+o.app_img+'"':"",productImgEmpty:o.app_img?"":"product-img-empty",marketPrice:parseFloat(o.market_price)>parseFloat(o.price)?"￥"+parseFloat(o.market_price):"",count:a?a.shoppingCount:0,shopId:s.shopId,attributeStr:i.getAttrStr(o),isRestock:i.isProductRestock(o)?1:0,idx:t},this)},getTagItemHtml:function(t,i){return $.formatString(e.tagItem,i,this,{method:parseInt(i.istags)?"showTag":"showActivity"})},calcProductSize:function(){var i=this.listContainerNode.width()-18;this.productHeight=parseInt(.5536*i),t.setStyleText($.formatString(e.dynaStyleTpl,{imgHeight:parseInt(i/3.2),buttonWidth:parseInt(i/5),buttonHeight:parseInt(i/6.4),countRight:parseInt(i/5)+1,countWidth:Math.max(32,parseInt(i/8.4)),tagHeight:parseInt(i/2.11)},this),this.viewName+"-productView-stylesheet")},imgLazyload:function(t){for(var i=t.wrapperH,e=Math.abs(t.y),n=e+i,o=this.productHeight,r=parseInt(e/o),a=[],s=0;100>s&&!(a.length*o>i);){var d=r*o,c=r*o+o;(d>e&&n>d||c>e&&n>c)&&a.push(r),r++,s++}for(var u=0,p=a.length;p>u;u++){var l,h=a[u],f=$("#"+this.viewName+"-product-img-"+h);f&&(l=f.data("url"))&&f.css("background-image","url("+l+")").data("url","")}},updateListShoppingCart:function(){var t=0;this.listContainerNode.find(".product-item").each(function(i,e){var o,r=$(e),a=r.data("id");(o=n.getProductById(a))&&o.shoppingCount?(r.find(".product-imgwrap").removeClass("product-zero").find(".product-count").html(o.shoppingCount),t++):r.find(".product-imgwrap").addClass("product-zero")}),0==t&&setTimeout(function(){$("body").toggleClass("bugfix-ui")},10)}},o}),/*!File[phone/index/ShopShow.js]*/
define("phone/index/ShopShow",["lib/base","phone/index/main","phone/index/ProductView","common/Dialog"],function(t,i,e,n){var o={categoryItem:'<li id="menu-category-#{id}" class="category-item ui-graybg #{isFolder}" data-id="#{id}">\n<span class="category-item-name" style="background-image:url(#{icon})">\n#{name}\n</span>\n<span class="category-item-expand">▼</span>\n<div class="bottom-line"></div>\n<ul class="subitem-ul">#{subitemList}</ul>\n</li>',categorySubItem:'<li id="menu-category-#{id}" class="category-subitem" data-name="#{name}" data-id="#{id}" data-folder-id="#{folderId}" style="background-image:#{backgroundImage}">\n<span class="point">●</span>\n#{name}\n<span class="point">●</span>\n</li>'},r=function(t){this.id=t?t.id:!1,this.data=t,this.parent=null,this.childs=[],this.offset=0,this.destoried=!1};r.prototype={addChild:function(t){t.parent=this,t.offset=this.childs.length,this.childs.push(t)},getCategoryModelById:function(t){for(var i=0,e=this.childs.length;e>i;i++){var n,o=this.childs[i];if(o.id==t)return o;if((n=o.getCategoryModelById(t))&&n.id==t)return n}},getNextCategoryModel:function(){var t;return(t=this.parent.childs[this.offset+1])||(t=this.parent.parent.childs[this.parent.offset+1]),t&&t.childs&&t.childs.length?t.childs[0]:t}};var a=function(n,o,a){this._isInited=!1,this.shopInfo=n.shop,this.shopId=this.shopInfo.zchtid,this.ctx=a,this.containerNode=a.find(".main"),this.categoryList=n.category,this.firstCategoryId=this.categoryList[0].id,this.shoppingCart=o,0==this.firstCategoryId?(this.categoryProductMap={0:n.category[0].childs},delete n.category[0].childs):this.categoryProductMap={},this.curCategoryId=null,this.productView=new e("menu",this.shopId,this.ctx.find(".list-product")),this._isExecuteFirstEnter=!1,this._defaultOpenCategory=[],this._categoryModel=new r;for(var s=0,d=this.categoryList.length;d>s;s++){var c=this.categoryList[s],u=new r(c);if(this._categoryModel.addChild(u),c.childs&&c.childs.length)for(var p=0,l=c.childs.length;l>p;p++){var h=new r(c.childs[p]);u.addChild(h)}}var f=this;$.each(n.category,function(e,n){if(n.childs&&n.childs.length){var o=n.id;f["loadFolderCategoryData_"+o]=t.onceExecMulitCallFn(function(){if(!f.destoried){var e=this;t.ajaxGet("/data/getCategoryProduct",{shopId:f.shopId,categoryId:o},function(t){if(!f.destoried){if(0!=t.errno)return e.done(!0),e.reset(),void 0;for(var n in t.data)f.categoryProductMap[n]=t.data[n];i.getShoppingCart().addProductDataList(t.data),e.done()}})}})}})};return a.prototype={init:function(){this._renderCategoryList()},executeOnFirstEnter:function(){if(!this._isExecuteFirstEnter){if(this._isExecuteFirstEnter=!0,i.showMaskGuide("geoGuide"),this._defaultOpenCategory&&this._defaultOpenCategory.length)for(var t=0,e=this._defaultOpenCategory.length;e>t;t++)this.expandFolderCategory(this._defaultOpenCategory[t],!0);parseInt(this.shopInfo.outofservice)&&n.alert("鲜蜂侠忙碌了一天补充能量中···<br/>现在下单可预订时间送达哦~")}},_changeCategory:function(t){var i=$("#menu-category-"+t);this.curCategoryId=t,this.containerNode.find(".category-item,.category-subitem").removeClass("active").removeClass("active-prev").removeClass("active-next"),i.addClass("active"),i.prev().addClass("active-prev"),i.next().addClass("active-next");var e=i.find(".category-item-icon").data("icon");e&&i.find(".category-item-icon").css("background-image","url("+(0==e.indexOf("http://")?e:SYS_CONF.domain.static+"/"+e)+")").data("icon",""),this._renderProductList(t)},expandFolderCategory:function(t,i,e){var n=this,o=$("#menu-category-"+t),r=$.throttle(100,function(){n.ctx.refreshIscroll("category"),e&&e()},!0);if(o.hasClass("expand")){if(i)return e&&e(),void 0;o.removeClass("expand"),o.find(".category-subitem").animate({height:0,opacity:0},250,r)}else o.addClass("expand"),o.find(".category-subitem").animate({height:"44px",opacity:1},250,r);this["loadFolderCategoryData_"+t]()},changeCategory:function(t,i){var e=$("#menu-category-"+t),o=this;if(e.hasClass("category-item-folder"))return this.expandFolderCategory(t),i&&this.changeCategory(i),void 0;if(this.categoryProductMap[t])return this._changeCategory(t),void 0;this.ctx.showLoading("加载中");var r=e.data("folder-id");this["loadFolderCategoryData_"+r](function(i){o.ctx.hideLoading(),i?n.tip("数据加载失败啦~"):o._changeCategory(t)})},getNextCategoryModel:function(){var t=this._categoryModel.getCategoryModelById(this.curCategoryId);return t.getNextCategoryModel()},update:function(){this.productView.updateListShoppingCart()},_renderCategoryList:function(){var i=[],e=!1,n=!1,r=this;$.each(this.categoryList,function(t,a){if(!(a.id<0)){parseInt(a.is_open)&&r._defaultOpenCategory.push(a.id);var s=a.childs&&a.childs.length?a.id:"";i.push($.formatString(o.categoryItem,a,{subitemList:function(){if(a.childs&&a.childs.length){var t=[];return $.each(a.childs,function(i,e){t.push($.formatString(o.categorySubItem,e,{folderId:s,backgroundImage:e.flag?"url("+e.flag+")":"none"}))}),t.join("")}return""},isFolder:s?"category-item-folder":""})),e||(e=a.id,a.childs&&a.childs.length&&(n=a.childs[0].id))}}),this._itemDelegateFn=function(i){i.stopPropagation();var e=$(this),n=e.data("id");n&&(e.hasClass("category-item-folder")?t.clickLog("menu_category_expand",{expand:!e.hasClass("expand")}):t.clickLog("menu_category_click",{categoryId:n,name:e.data("name")}),r.changeCategory(n))},this.containerNode.find(".list-category-ul").html(i.join("")).delegate(".category-item,.category-subitem",$.tapClick,this._itemDelegateFn),this.calcProductSize(),this.ctx.refreshIscroll("category",!0),this.changeCategory(e,n)},_renderProductList:function(t){var i=this.categoryProductMap[t],e=[],n=this,o=0==t?"getTagItemHtml":-1==t?"":"getProductItemHtml";i&&$.each(i,function(t,i){e.push(n.productView[o](t,i))}),this.containerNode.find(".list-product-ul").html(e.join("")),this.ctx.refreshIscroll("product",!0)},calcProductSize:function(){this.productView.calcProductSize()},imgLazyload:function(t){this.productView.imgLazyload(t)},getShopinfo:function(){return $.formatString("配送店：#{number}<br>#{WorkBegin} - #{WorkEnd}，#{range}公里",this.shopInfo)},destory:function(){this.destoried=!0,this.containerNode.find(".list-category-ul").off($.tapClick,".category-item,.category-subitem",this._itemDelegateFn),this.shopInfo=this.containerNode=this.categoryList=this.categoryProductMap=this.productView=null}},a}),/*!File[phone/index/CouponMgr.js]*/
define("phone/index/CouponMgr",["lib/base","lib/EventObj","lib/Loading","common/Dialog"],function(t,i,e,n){var o={content:'<div class="inputwrap prop-unexpand-hidden">\n<form onsubmit="return false;" class="propcode-form">\n<input class="inputwrap-input input-propcode" name="propcode" type="text" placeholder="请输入优惠码" value="" />\n<input type="submit" class="inputwrap-button input-propcode-submit" value="验证"  />\n</form>\n</div>\n<div class="prop-label prop-unexpand-hidden">#{labelWord}</div>\n<ul class="prop-list">#{couponList}</ul>',coupon:'<li class="prop-coupon #{extraClassname}" data-pwd="#{card_pwd}"><div class="coupon-value">#{couponVal}</div>#{name}<br/>优惠码：#{card_pwd}</li>'},r=$.inherits(i,{constructor:function(t){i.call(this),this.addrId=t.addrId,this.idformat=t.idformat,this.dateid=t.dateid,this.datestr=t.datestr,this.canUse=this.addrId&&this.idformat,this._isExpand=!1,this._couponList=null,this._isDestoried=!1,this._usedPropcode=!1,this.contentNode=null},bindUseUi:function(t,i){this.contentNode=i,this.expandNode=t;var e=this;t.on($.tapClick,function(){e._isDestoried||e._expandCouponList()}),i.delegate("form","submit",function(){if(!e._isDestoried){var t=$(this).serializeForm(),i=t.propcode;e._verifyCoupon(i,!0)}}),i.delegate(".prop-coupon",$.tapClick,function(){if(!e._isDestoried){var t=$(this),i=t.attr("data-pwd");e._isExpand?e._verifyCoupon(i):(e.cancelPropcode(),t.removeClass("selected"),t.addClass("prop-unexpand-hidden"),e.fire("uiChange"))}}),e.on("couponVerified",function(t){e._isDestoried||t.success&&(i.find(".prop-coupon").each(function(i,n){var o=$(n),r=o.attr("data-pwd");t.propcode==r?(o.addClass("selected"),o.removeClass("prop-unexpand-hidden")):(o.removeClass("selected"),o.addClass("prop-unexpand-hidden")),e.fire("uiChange")}),e._expandCouponList())})},destory:function(){this._isDestoried=!0},cancelPropcode:function(){this._usedPropcode=!1,this.fire("cancelPropcode")},getPropcode:function(){return this._usedPropcode},_renderCouponList:function(){var t=this._couponList,i=this,e=[];for(var n in t){var r=t[n],a=parseFloat(r.value);e.push($.formatString(o.coupon,r,{extraClassname:i._usedPropcode&&i._usedPropcode==r.card_pwd?"selected":"prop-unexpand-hidden",couponVal:isNaN(a)?r.value:"￥"+a}))}this.contentNode.html($.formatString(o.content,{couponList:e.join(""),labelWord:e.length?"可使用的优惠券":"没有可使用的优惠券"})),this.fire("uiChange")},_expandCouponList:function(){var t=this;this._isExpand?(this._isExpand=!1,this.expandNode.find("span").html("▼"),this.contentNode.addClass("unexpand"),this.fire("uiChange")):this._getCouponList(function(){t._renderCouponList(),t._isExpand=!0,t.expandNode.find("span").html("▲"),setTimeout(function(){t.contentNode.removeClass("unexpand"),t.fire("uiChange")},10)})},_verifyCoupon:function(i,o){if(i){if(i.length<7)return n.alert("您填写的优惠券号码太短了~"),void 0;var r=this;e.show("验证中"),t.ajaxPost("/submit/couponVerify",{addrId:r.addrId,idformat:r.idformat,dateid:r.dateid,datestr:r.datestr,propcode:i},function(a){e.hide();var s={success:0==a.errno,msg:a.errmsg,propcode:i,data:a.data};0==a.errno?(r._usedPropcode=i,o&&(r._couponList=$.extend(r._couponList,a.data.coupon),r._renderCouponList(),t.ajaxPost("/submit/couponBind",{propcode:i},$.noop))):n.alert(a.errmsg),r.fire("couponVerified",s)})}},_getCouponList:function(i){if(null!==this._couponList)return i&&i(this._couponList),void 0;var n=this;e.show("获取可用优惠券中"),t.ajaxPost("/submit/couponList",{addrId:n.addrId,idformat:n.idformat,dateid:n.dateid,datestr:n.datestr},function(t){e.hide(),n._couponList=0==t.errno?t.data:{},i&&i(t.data)})}});return r}),/*!File[phone/index/view_index.js]*/
define("phone/index/view_index",["lib/base","common/Dialog","phone/index/main"],function(t,i,e){return function(t){var i=!1,n=!1,o=function(){var i=function(){var i=null,e=1,n=!1,o=function(){e=1-e,t.find(".location").css("opacity",e||.1),i=setTimeout(o,800)};return{start:function(){n||(o(),n=!0)},stop:function(){t.find(".location").css("opacity",1),clearTimeout(i),n=!1}}}();t.on($.tapClick,function(){t.changeView("menu")}),e.getAddrMgr().on("progressing",function(){i.start()}).on(["addrChange","addrChangeError","gpsError"],function(){i.stop(),n=!0,r()})},r=function(){t.isCurrentView()&&i&&n&&setTimeout(function(){t.changeView("menu")},100)},a=function(){i=!1,n=!1,setTimeout(function(){i=!0,r()},2e3)},s=function(){};return{init:o,onenter:a,onleave:s}}}),/*!File[phone/index/view_menu.js]*/
define("phone/index/view_menu",["lib/base","lib/Performance","common/Dialog","phone/index/main","phone/index/ShopShow"],function(t,i,e,n,o){return function(r){var a,s=null,d=null,c=function(){s=n.getShoppingCart(),s.delegateOperate(r.find(".list-product-ul")).on("shoppingListChange",function(t){r.isCurrentView()&&(d&&d.update(),"add"==t.reason&&n.showMaskGuide("cartGuide"))}),s.bindBarUi(r.find(".pub-cart")),n.getAddrMgr().on("addrChange",function(t){s.setShopData(t.data.shop),r.hideLoading(),d&&d.destory(),d=new o(t.data,s,r),d.init(),r.isCurrentView()&&setTimeout(function(){d.executeOnFirstEnter()},1e3),setTimeout(n.checkWelcomeLogoCache,3e3),i.makeTime("listShow").addData("cityid",t.data.shop.cityid).report()}).on("progressing",function(t){r.setTitle(t.text+"...")}).on("gpsParsed",function(t){a='<span class="icon icon-location"></span>&nbsp;'+t.street+"附近▼",r.setTitle(a)}).on("addrChange",function(t){"gps"!=t.userAddr.type&&(a='<span class="icon icon-location"></span>&nbsp;'+t.userAddr.address+"▼",r.setTitle(a))}).on("addrChangeError",function(t){r.setTitle(a||"服务异常"),r.whenShowingDo(function(){e.alert(t.errmsg)})}).on("gpsParsedError",function(){r.setTitle("解析失败")}).on("gpsError",function(){r.setTitle("定位失败"),r.whenShowingDo(function(){e.alert("GPS定位错误，请检查您的GPS设置<br/>或手动输入配送地址",function(){r.showOverlay("addr")})})}),$(window).on("resize",function(){r.isCurrentView()&&d&&d.calcProductSize()}),r.find(".header-content").on($.tapClick,function(){r.showOverlay("addr"),t.clickLog("overlay_addr_show")}).on("longTap",function(){var t=[d&&d.getShopinfo(),$.wbr("GeoLogid:"+SYS_CONF.geologid),"Logid:"+SYS_CONF.logid,"env:"+SYS_CONF.environ];e.alert(t.join("<br/>"))}),r.find(".pub-cart").delegate(".expand",$.tapClick,function(){s.getCount()&&r.showOverlay("cart")}),r.find(".list-product"),i.init()},u=function(){r.hideOverlay()},p=function(){d&&(d.calcProductSize(),d.update(),setTimeout(function(){d.executeOnFirstEnter()},1e3)),r.isFirstEnter()&&setTimeout(function(){r.find(".main").removeClass("main-empty")},30),r.refreshIscroll()},l=function(){n.needVerified(function(){r.changeView("cart")})},h=function(){n.needVerified(function(){r.changeView("mine")})},f=function(t,i,e){r.showOverlay("detail",t,i,e)},g=function(){var t=$.throttle(150,function(t){d&&d.imgLazyload(t)}),i=function(t){for(var i=[],e=0;t>e;e++)i.push($.formatString('<div class="next-progress-line" style="-webkit-transform:rotate(#{rotate}deg);opacity:#{opacity}"></div>',{rotate:Math.floor(e/12*360),opacity:e/24+.3}));r.find(".scroll-next .next-progress").html(i.join(""))},e=$.throttle(50,function(t){var e=d?d.getNextCategoryModel():!1;if(!e)return r.find(".scroll-next").css("opacity",0),void 0;var n=Math.max(t.scrollerH,t.wrapperH)-t.wrapperH+t.y;if(r.find(".next-category-name").html(e.data.name),-80>n)i(12),r.find(".scroll-next").css("opacity",1),r.find(".next-word").html("松开即可");else if(-5>n){var o=Math.abs(n/80*12);i(o),r.find(".scroll-next").css("opacity",1),r.find(".next-word").html("向上拖动")}else r.find(".scroll-next").css("opacity",0)});return function(i){t(i),e(i)}}(),m=function(i){var e=Math.max(i.scrollerH,i.wrapperH)-i.wrapperH+i.y;if(-80>e){var n=d?d.getNextCategoryModel():!1,o=function(t){r.scrollToElement("category",$("#menu-category-"+t)[0])};n&&(n.parent&&n.parent.id?(d.expandFolderCategory(n.parent.id,!0,function(){o(n.id)}),d.changeCategory(n.id)):(d.changeCategory(n.id),o(n.id)),t.clickLog("scroll_refresh_category"))}};return{init:c,onenter:p,onleave:u,cartOk:l,showDetail:f,me:h,productScroll:$.throttle(150,g),productScrollEnd:m,showTag:function(t,i,e,n){r.changeView("tag",t,{id:i,name:e,img:n})},showActivity:function(t,i,e,n){r.changeView("act",t,{id:i,name:e,img:n})},fixCategoryIscroll:function(){r.refreshIscroll("category")}}}}),/*!File[phone/index/view_tag.js]*/
define("phone/index/view_tag",["lib/base","phone/index/main","phone/index/ProductView"],function(t,i,e){return function(n){var o,r=function(){$(window).on("resize",function(){n.isCurrentView()&&o&&o.calcProductSize()}),i.getShoppingCart().bindBarUi(n.find(".pub-cart")).delegateOperate(n.find(".tag-list")).on("shoppingListChange",function(){n.isCurrentView()&&o&&o.updateListShoppingCart()}),n.find(".pub-cart").delegate(".expand",$.tapClick,function(){i.getShoppingCart().getCount()&&n.showOverlay("cart")})},a=function(r,a){if(r){n.setTitle(a.name);var s=n.find(".tag-list").html("");o=new e("tag",r,s),o.calcProductSize(),s.html(o.getTagItemHtml(0,a)),t.ajaxGet("/data/getTagProduct",{shopId:r,tagId:a.id},function(t){if(0==t.errno){var e=[o.getTagItemHtml(0,a)];i.getShoppingCart().addProductDataList(t.data),$.each(t.data,function(t,i){e.push(o.getProductItemHtml(t,i))}),s.html(e.join("")),n.refreshIscroll(!0)}})}},s=function(t){o&&o.imgLazyload(t)},d=function(t,i,e){n.showOverlay("detail",t,i,e)},c=function(){i.needVerified(function(){n.changeView("cart")})};return{cartOk:c,productScroll:$.throttle(150,s),onenter:a,init:r,back:function(){return"menu"},showDetail:d}}}),/*!File[phone/index/view_act.js]*/
define("phone/index/view_act",["lib/base","activity/bridge","phone/index/main"],function(t,i,e){return function(n){var o,r,a,s={},d=function(){e.getShoppingCart().bindBarUi(n.find(".pub-cart")),n.find(".pub-cart").delegate(".expand",$.tapClick,function(){e.getShoppingCart().getCount()&&n.showOverlay("cart")}),i.setInitHandler(function(t,i){var e=Bee.getMod("activity/act_"+t,!0);e&&(s=e,e.init&&e.init(i))})},c=function(t,i){t&&i&&(r=t,a=i),n.setTitle(a.name),o=a.id,u()},u=function(){n.showLoading("加载中"),t.ajaxLoad(n.find(".main").html(""),"/show/active",{shopId:r,id:o},function(){n.hideLoading()})},p=function(){s&&s.destory&&s.destory()};return{init:d,onenter:c,onleave:p,back:function(){return"menu"},getShareObj:function(){return s&&s.getShareObj?s.getShareObj():void 0},cartOk:function(){e.needVerified(function(){n.changeView("cart")})},load:u}}}),/*!File[phone/index/view_cart.js]*/
define("phone/index/view_cart",["lib/base","lib/RelSelect","common/Dialog","phone/index/main"],function(t,i,e,n){var o={addrEmpty:"收货地址：请选择",addrLoading:"<p>地址加载中。。</p>",addr:'#{name} &nbsp; #{phone}<br/>\n<div class="ui-ellipsis"> #{address} </div>'};return function(r){var a,s,d,c,u,p=function(){var t=a.getShoppingList(),i=[];$.each(t,function(t,e){i.push(n.formatCartProduct(e))}),r.find(".list-shopping-ul").html(i.join("")),r.refreshIscroll()},l=function(){var i=s.getShopData().shop.zchtid;t.ajaxGet("/data/getShopTime",{shopId:i},function(t){0==t.errno&&(u=t.data,d.setData(u.str))})},h=function(){var t=n.getAddrMgr().getLastAddr();addrHtml=t?$.formatString(o.addr,t):o.addrEmpty,r.find(".addr").html(addrHtml)},f=function(){a=n.getShoppingCart(),s=n.getAddrMgr(),a.on("shoppingListChange",p),a.delegateOperate(r.find(".list-shopping-ul")),a.bindBarUi(r.find(".pub-cart"),"结算"),d=new i({containerNode:r.find(".select-time-day"),selectName:"dateid",dataParser:function(t,i){return{value:t,name:i}}}),c=new i({containerNode:r.find(".select-time-hour"),selectName:"datestr"}),c.setParent(d,function(t){var i=u.date[t.value];this.setData(i)}),s.on("addrChange",l),s.on("userAddrDecided",h)},g=function(){p(),h()},m=function(){},v=function(){n.selectAddress("cart"),t.clickLog("cart_selectAddr")},y=function(){var i=n.getAddrMgr(),o=i.getLastAddr();if(!o)return e.alert("请选择收货地址"),void 0;var s={idformat:a.getIdformat(),addrId:o.id,dateid:d.getValue(),datestr:c.getValue(),dateidName:d.getName(),datestrName:c.getName()};r.showLoading("验证中"),t.ajaxPost("/submit/checkOrder",s,function(t){if(r.hideLoading(),0==t.errno)r.changeView("confirm",t.data,$.extend({dateid:d.getValue(),datestr:c.getValue(),dateidName:d.getName(),datestrName:c.getName()},s));else if(6005==t.errno){var i=t.data.lack_goods||t.data.unexist_ids;if(i&&i.length){for(var n=0,o=i.length;o>n;n++)a.deleteProduct(i[n],!0);e.alert("购物车中有商品不在此配送区<br/>已帮您搬出购物车~")}else e.alert(t.errmsg)}else e.alert(t.errmsg)})};return{init:f,onenter:g,onleave:m,back:function(){return"menu"},selectAddr:v,cartOk:y}}}),/*!File[phone/index/view_addrlist.js]*/
define("phone/index/view_addrlist",["phone/index/main"],function(t){var i={addr:'<li class="addr-item ui-graybg">\n<div class="addr-info tap-action" data-tap="select|#{id}">\n#{name}<span class="ui-float-right">#{phone}</span>\n<div class="ui-ellipsis">\n#{getDistrictName}#{address}\n</div>\n\n</div>\n<div class="addr-del addr-btn tap-action" data-tap="del|#{id}">删除</div>\n<div class="addr-edit addr-btn tap-action" data-tap="edit|#{id}">编辑</div>\n</li>'};return function(e){var n,o=!1,r=function(){o&&(e.find(".addr-item").removeClass("showdel"),o=!1)},a=function(){e.find(".list-addr").delegate(".addr-item","swipeLeft",function(){r(),$(this).addClass("showdel"),o=!0})},s=function(){var n=[];$.each(t.getAddrMgr().getAddrList(),function(t,e){n.push($.formatString(i.addr,e))}),e.find(".list-addr").html(n.join("")),e.refreshIscroll()},d=function(t){n=t,s()},c=function(t){e.changeView("addredit",t,n)},u=function(i){return o?(r(),void 0):"mine"==n?(e.changeView("addredit",i,n),void 0):(t.getAddrMgr().setLastAddrId(i),n?e.changeView(n):e.viewBack(),void 0)},p=function(i){t.getAddrMgr().delAddr(i,s)};return{init:a,onenter:d,back:function(){return n||"cart"},edit:c,select:u,del:p,hideDel:r}}}),/*!File[phone/index/view_addredit.js]*/
define("phone/index/view_addredit",["lib/base","lib/RelSelect","common/Dialog","common/AreaInfo","phone/index/main"],function(t,i,e,n,o){var r={lis:'<li>联系人<span class="ui-hidden">中</span>：\n<input class="input addr-input-name" name="name" type="text" size="10" maxlength="10" value="#{name}" placeholder="收货人姓名"/>\n<span style="display:#{weixinAddress}" class="addr-weixin-address ui-float-right"></span>\n</li>\n<li class="ui-nowrap">地址<span class="ui-hidden">中中</span>：\n<span class="addr-city">\n</span>\n<span class="addr-district">\n</span>\n</li>\n<li>街道地址：\n<input class="input addr-input-address" name="address" type="text" value="#{address}" placeholder="详细收货地址"/>\n</li>\n<li>手机号<span class="ui-hidden">中</span>：\n<input id="autocomplete-phone" class="input addr-input-phone" name="phone" type="tel" maxlength="11" value="#{phone}" placeholder="收货人手机号" autocomplete="on" />\n</li>\n',option:'<option value="#{id}" #{selected}>#{name}</option>'};return function(t){var a,s,d,c,u=null,p=null,l=function(){p=o.getAddrMgr(),p.on("gpsParsed",function(t){s=t.city}),t.find("form").on("submit",h),t.find(".header-right").on($.tapClick,function(){var i=u?u.id:!1;i&&o.getAddrMgr().delAddr(i,function(i){i?e.alert("删除成功",function(){t.viewBack()}):e.alert("删除失败")})}),t.delegate(".addr-weixin-address",$.tapClick,function(){window.WeixinJSBridge.invoke("editAddress",$.extend({scope:"jsapi_address"},SYS_CONF.sns.signedParam),function(i){"edit_address:ok"==i.err_msg?d.isDataHasName(i.addressCitySecondStageName)?(e.tip("地址导入成功"),t.find(".addr-input-name").val(i.userName),t.find(".addr-input-phone").val(i.telNumber),t.find(".addr-input-address").val(i.addressDetailInfo),d.setName(i.addressCitySecondStageName),setTimeout(function(){c.setName(i.addressCountiesThirdStageName)},100)):e.alert("地址导入失败<br/>"+i.addressCitySecondStageName+"暂时不在鲜蜂侠的配送范围哦~"):e.alert("地址导入失败:"+i.err_msg)})})},h=function(){t.blurInput();var i=$(this).serializeForm(),n="";return i.name?i.districtId?i.length<5?n="请填写详细收货地址，至少5个字":i.phone?i.phone.match(/^1\d{10}$/)||(n="请正确填写手机号"):n="请填写手机号":n="请选择区域":n="请填写联系人姓名",n?(e.alert(n),!1):(u&&u.id?p.updateAddr(u.id,i,function(){a?("cart"==a&&p.setLastAddrId(u.id),t.changeView(a)):t.viewBack()}):p.addNewAddr(i,function(i){p.setLastAddrId(i.id),t.changeView("cart")}),!1)},f=function(e,o){a=o,u=e?p.getAddrById(e):p.getTempAddr(),t.find(".edit-ul").html($.formatString(r.lis,u||{},{weixinAddress:$.isWeixin&&!u?"inline":"none"})),d=new i({selectName:"cityId",containerNode:t.find(".addr-city"),dataParser:function(t,i){return{name:i.name,value:i.id}}}),c=new i({selectName:"districtId",containerNode:t.find(".addr-district"),dataParser:function(t,i){return{name:i.name,value:i.id}},emptyName:"请选择区域"}),c.setParent(d,function(t){this.setData(n[t.selectedIndex].districts,u?u.districtId:!1)}),d.setData(n,u?u.cityId:!1),t.find(".header-right").css("display",u&&u.id?"":"none"),t.refreshIscroll()};return{init:l,onenter:f,back:function(){return(o.getAddrMgr().getAddrCount()?"addrlist":"cart")+(a?"|"+a:"")},fixIOS70Input:function(i){"name"!=i.name&&t.scrollToElement("content",i,200)}}}}),/*!File[phone/index/view_confirm.js]*/
define("phone/index/view_confirm",["lib/base","common/Pay","common/Dialog","phone/index/main","phone/index/CouponMgr"],function(t,i,e,n,o){var r={frame:'<div class="block block-addr">\n#{name} &nbsp; #{phone}\n<div class="ui-ellipsis">#{address}</div>\n<hr />\n<span class="ui-float-right">#{time}</span>\n收货时间\n</div>\n<ul class="block confirm-product-list"></ul>\n<div class="prop block">\n<p class="prop-use icon-gift">\n使用优惠券\n<span class="ui-float-right">▼</span>\n</p>\n<div class="prop-content"></div>\n</div>\n<div class="block confirm-amount">\n</div>\n<div class="comment block">\n备注：\n<input class="input-postscript inputbox" size="30" type="text" name="postscript" placeholder="让鲜蜂侠带点什么呢？" value="#{postscript}" />\n</div>\n<ul class="pay-list block">\n#{payList}\n</ul>\n<div class="bigbtn bigbtn-one">\n确定下单\n</div>\n<br />\n<br />',amount:'商品总计：￥#{payable_amount}<br/>\n优惠金额：<#{promotionsTag}>￥#{promotionsPrice}</#{promotionsTag}><br/>\n<span class="ui-float-right">需支付：<strong>￥#{order_amount}</strong></span>\n运<span class="ui-hidden">中中</span>费：￥#{real_freight}',pay:'<li class="pay-item tap-action #{defaultPay} pay-item-#{key}" data-tap="selectPay|#{key}">\n<span class="pay-icon pay-icon-#{key}"></span>\n#{payTitle}\n#{msg}\n</li>'};return function(a){var s,d,c=!1,u=null,p=function(){a.delegate(".bigbtn-one",$.tapClick,function(){if(!c)return e.alert("请选择支付方式"),void 0;var o=i.get(c),r={idformat:s.idformat,addrId:s.addrId,propcode:u.getPropcode()||"",postscript:a.find(".input-postscript").val(),paytype:o.getPayType()};$.extend(r,s),a.showLoading("提交订单中"),t.ajaxPost("/submit/makeOrder",r,function(t){0==t.errno?(n.getShoppingCart().reset(),location.href="/show/order?orderId="+t.data.orderid+"&orderNo="+t.data.orderno+"&pay="+(o.getPayType()==i.PAYTYPE_ONLINE?1:0)):(a.hideLoading(),e.alert(t.errmsg))})})},l=function(t,e){if(t&&e){s=e,d=t;var p=function(i){if(t.pay&&t.pay.length)for(var e=0,n=t.pay.length;n>e;e++){var o=t.pay[e];if(o.msg&&o.type==i)return'<span class="pay-msg">'+o.msg+"</span>"}},l=function(i){if(t.pay&&t.pay.length)for(var e=0,n=t.pay.length;n>e;e++){var o=t.pay[e];if(o.title&&o.type==i)return o.title}};a.find(".content").html($.formatString(r.frame,{payList:function(){var t=[];return $.each(i.getSupportPays(),function(i,e){0==i&&(c=e.key),t.push($.formatString(r.pay,e,{idx:i,defaultPay:0==i?"icon-ok":"",msg:p(e.typeid),payTitle:l(e.typeid)||e.name}))}),t.join("<hr/>")},time:(0==s.dateid?"":s.dateidName)+"&nbsp;"+s.datestrName},n.getAddrMgr().getLastAddr())),h(t),u=new o(s),u.bindUseUi(a.find(".prop-use"),a.find(".prop-content")),u.on("couponVerified",function(t){t.success&&h(t.data)}).on("uiChange",function(){setTimeout(function(){a.refreshIscroll()},600)}).on("cancelPropcode",function(){h(d)})}else a.viewBack()},h=function(t){var i=[];$.each(t.goods,function(t,e){e.shoppingCount=e.shoppingCount||e.buy_num||0,i.push(n.formatCartProduct(e,!0))}),a.find(".confirm-product-list").html(i.join("")),a.find(".confirm-amount").html($.formatString(r.amount,t,{promotionsPrice:parseFloat(t.promotions),promotionsTag:parseInt(t.promotions)?"strong":"span"})),a.refreshIscroll()},f=function(){u&&u.destory()},g=function(t){c=t,a.find(".pay-item").removeClass("icon-ok").filter(".pay-item-"+t).addClass("icon-ok")};return{init:p,onenter:l,onleave:f,back:function(){return"cart"},selectPay:g,fixIOS70Input:function(t){a.scrollToElement("content",t,100)}}}}),/*!File[phone/index/view_verify.js]*/
define("phone/index/view_verify",["phone/index/main"],function(t){return function(i){var e,n,o,r=function(){var n=t.getUser();n.bindLogin(i.find(".main"),function(){e?e():i.viewBack()}),i.find(".login-input").on("focus",function(){clearTimeout(o),i.find(".pic").addClass("pic-hide")}).on("blur",function(){o=setTimeout(function(){i.find(".pic").removeClass("pic-hide")},2e3)})},a=function(t,o){e=t,n=o,i.find(".login-voice-wrap").html('收不到短信？使用<span class="ui-bluelink login-voice-link">语音验证码</span>')};return{init:r,onenter:a,back:function(){return n},fixIOS70Input:function(){i.find(".pic").addClass("pic-hide")}}}}),/*!File[phone/index/view_mine.js]*/
define("phone/index/view_mine",["lib/base","common/User","common/Dialog"],function(t,i,e){return function(t){var n=function(){t.refreshIscroll(),t.find(".me-phone").html(i.getInstance().getRawPhone())},o=function(n){"order"==n?window.location.href="/show/orderlist?back=mine":"coupon"==n?t.changeView("coupon"):"address"==n?t.changeView("addrlist","mine"):"logout"==n&&e.confirm("您确定要退出登录吗？",function(){i.getInstance().logout(function(){t.changeView("menu")})})};return{back:function(){return"menu"},onenter:n,itemClick:o}}}),/*!File[phone/index/view_coupon.js]*/
define("phone/index/view_coupon",["common/Dialog"],function(t){return function(i){var e={couponItem:'<li class="coupon-item unexpand coupon-item-status-#{status}">\n<div class="coupon-item-value coupon-item-bg">#{valueStr}</div>\n<div class="coupon-item-detail coupon-item-bg">\n#{name}<br/>优惠码：#{card_pwd}<br/>#{description}\n</div>\n<div class="coupon-item-duration coupon-item-bg">\n#{start_time}至#{end_time}有效\n</div>\n<div class="coupon-item-radius coupon-item-radius-top"></div>\n<div class="coupon-item-radius coupon-item-radius-bottom"></div>\n#{statusCircle}\n</li>'},n=[],o=function(t){return t.status=t.status||"0",$.formatString(e.couponItem,t,{statusCircle:function(){var i;if(1==t.status)i="已使用";else{if(2!=t.status)return;i="已过期"}return'<div class="coupon-item-status">'+i+"</div>"},valueStr:function(){var i=parseFloat(t.value);return isNaN(i)?t.value:i+"元"}})},r=function(){i.delegate("form","submit",function(){var e=i.find(".inputwrap-input").val();if(e)return base.ajaxPost("/submit/couponBind",{propcode:e},function(e){if(0==e.errno){var n;for(n in e.data)break;i.find(".inputwrap-input").val(""),i.refreshIscroll(!0),i.find(".coupon-list").prepend(o(e.data[n])),s()}else t.alert(e.errmsg)}),!1})},a=function(){i.find(".coupon-list").html(""),i.showLoading("加载中"),base.ajaxPost("/submit/couponMy",{},function(t){if(0==t.errno){n=t.data,i.hideLoading();var e=[];for(var r in n){var a=n[r];e.push(o(a))}i.find(".coupon-list").html(e.join("")),s()}})},s=function(){setTimeout(function(){i.find(".coupon-item").removeClass("unexpand"),setTimeout(function(){i.refreshIscroll()},500)},100)};return{init:r,back:function(){return"mine"},onenter:a}}}),/*!File[phone/index/overlay_addr.js]*/
define("phone/index/overlay_addr",["lib/RelSelect","phone/index/main","common/AreaInfo","common/Dialog"],function(t,i,e,n){var o={option:'<option value="#{id}" #{selected}>#{name}</option>',addrItem:'<li class="addr-li ui-ellipsis" data-id="#{id}">#{getDistrictName}#{address}</li>'};return function(r){var a,s,d=null,c=function(){d=i.getAddrMgr(),a=new t({selectName:"cityId",containerNode:r.find(".city-td"),dataParser:function(t,i){return{name:i.name,value:i.id}}}),s=new t({selectName:"districtId",containerNode:r.find(".district-td"),dataParser:function(t,i){return{name:i.name,value:i.id}},emptyName:"请选择区域"}),s.setParent(a,function(t){this.setData(e[t.selectedIndex].districts)}),a.setData(e),d.on("gpsParsed",function(t){a.setName(t.city)}).on("addrListChange",u).on("addrChange",function(){r.hide()}),r.find(".header-content").on($.tapClick,function(){r.hide()}),r.find(".addr-form").on("submit",function(){var t=$(this).serializeForm();return t.districtId?t.address.length<5?(n.alert("请输入详细配送地址"),!1):(d.setTempAddr(t),r.hide(),!1):(n.alert("请选择区域"),!1)}),r.find(".history-ul").delegate(".addr-li",$.tapClick,function(){var t=$(this).data("id");d.setLastAddrId(t),r.hide()}),r.find(".geo").on($.tapClick,function(){d.isGpsAddr()||d.initGPS(),r.hide()})},u=function(){var t=[];$.each(d.getAddrList(),function(i,e){t.push($.formatString(o.addrItem,e))}),r.find(".history-ul").html(t.join("")),r.refreshIscroll()},p=function(){r.find(".content").animate({translate3d:"0,0,0"},400,"ease-in"),u()},l=function(){r.find(".content").animate({translate3d:"0,-100%,0"},400,"ease-out",function(){r.hideLayer()}),r.goBack()};return{show:p,hide:l,init:c}}}),/*!File[phone/index/overlay_cart.js]*/
define("phone/index/overlay_cart",["lib/base","phone/common/PageView","phone/index/main"],function(t,i,e){return function(n){var o={item:'<li class="shopping-item">\n<div class="product-name product-absolute ui-ellipsis">#{name}</div>\n<div class="product-else product-absolute">\n<div class="product-price">￥#{price}</div>\n<div class="product-del shopping-action" data-action="#{id}:-">-</div>\n<div class="product-count">#{shoppingCount}</div>\n<div class="product-add shopping-action" data-action="#{id}:+">+</div>\n</div>\n</li>'},r=null,a=function(){var t=[],i=r.getShoppingList();$.each(i,function(i,e){t.push($.formatString(o.item,e))}),n.find(".list-shopping-ul").html(t.join("")),r.bindBarUi(n.find(".pub-cart")),n.refreshIscroll(),n.isShowing()&&0==r.getCount()&&n.hide()},s=function(){r=e.getShoppingCart().on("shoppingListChange",a).delegateOperate(n.find(".list-shopping-ul")),n.find(".pub-cart").delegate(".expand",$.tapClick,function(){n.hide()})},d=function(){n.find(".cart-detail").animate({translate3d:"0,0,0"},400,"ease-in"),n.find(".icon-cart-inner").animate({translate3d:"0,-290px,0"},400,"ease-in"),a(),n.refreshIscroll(),t.clickLog("cart_expand")},c=function(){n.find(".icon-cart-inner").animate({translate3d:"0,0,0"},400,"ease-out"),n.find(".cart-detail").animate({translate3d:"0,100%,0"},400,"ease-out",function(){n.hideLayer()}),n.goBack()},u=function(){n.hide(),e.needVerified(function(){i.changeView("cart")})};return{cartOk:u,show:d,hide:c,init:s}}}),/*!File[phone/index/overlay_detail.js]*/
define("phone/index/overlay_detail",["common/weixinUtils","common/Share","phone/index/main"],function(t,i,e){return function(n){var o,r,a=function(t,i,e){o=t,r=i;var a=n.find(".content").animate({translate3d:"0,0,0"},400,"ease-in").width();n.find(".detail-content").load($.formatString("/show/productDetail?id=#{id}&shopId=#{shopId}&width=#{width}&disabled=#{disabled}",{id:t,shopId:i,width:a,disabled:e}),s)},s=function(){n.refreshIscroll(!0),n.find("img").on("load",function(){n.refreshIscroll()}).each(function(t,i){var e=$(i).data("src");e&&(i.src=e)}),c()},d=function(){n.find(".content").animate({translate3d:"0,100%,0"},400,"ease-out",function(){n.hideLayer()}),n.goBack()},c=function(){var t=e.getShoppingCart().getProductById(o),i=t?t.shoppingCount:0;n.find(".product-count").html(i)},u=function(){n.find(".detail-close").on($.tapClick,function(){n.hide()}),n.delegate(".icon-share",$.tapClick,function(){$.isWeixin&&t.shareTip(!1)}),e.getShoppingCart().delegateOperate(n.find(".detail-content")).on("shoppingListChange",function(){n.isShowing()&&c()})},p=function(){var t=e.getShoppingCart().getProductObjById(o);return i.getProductShareObj(t,r)};return{show:a,hide:d,init:u,getShareObj:p}}}),/*!File[phone/index/main.js]*/
define("phone/index/main",["lib/base","common/ShoppingCart","common/AddrManager","common/Dialog","common/UserStatus","common/User","common/weixinUtils","phone/common/PageView","phone/common/Overlay"],function(t,i,e,n,o,r,a,s,d){var c={product:'<li class="mod-shopping-item shopping-item #{disabledClass}" data-id="#{id}" data-anime="1">\n<div class="product-imgwrap">\n<img src="#{app_mimg}" alt="#{name}" width="60" height="60" />\n</div>\n<div class="product-info">\n<h6 class="product-name ui-ellipsis">#{name}</h6>\n<br />\n<p class="product-detail">\n<span class="product-price">￥#{price}</span>\n<span class="product-attribute">#{attributeStr}</span>\n</p>\n</div>\n<div class="product-operate">\n<div class="product-del shopping-action" #{opHidden} data-action="#{id}:-">-</div>\n<div class="product-count">#{shoppingCount}</div>\n<div class="product-del shopping-action" #{opHidden} data-action="#{id}:+">+</div>\n</div>\n</li>'},u=null,p=null,l=function(t){var i=Bee.getMod("phone/index/view_"+t);s.defineView(t,i)},h=function(t){var i=Bee.getMod("phone/index/overlay_"+t);d.defineOverlay(t,i)},f=function(){var t=d.getCurOverlayObj()||s.getCurViewObj();return t.getShareObj?t.getShareObj():void 0},g=!1,m=function(){if(!g){g=!0;var i=t.safeGetProp(window.SYS_CONF,"promotion.welcomeLogo")||{},e="__bee__welcomeLogoImg";i.active&&!i.hadCached&&(window[e]=new Image,window[e].onload=function(){$.setCookie("welcomeLogoCacheKey",i.cacheKey,{path:"/",expires:5184e6}),delete window[e]},window[e].src=i.url)}},v=function(){i.reset(),$(window).on("load",function(){setTimeout(scrollTo,0,0,0)});window.SYS_CONF.promotion.timestart||{};u=new e,p=r.getInstance(),p.on("statusChange",function(){this.isLogin()&&setTimeout(function(){u.init()},500)}),$("#mod-guide-mask").on($.tapClick,function(){$(this).css("display","none"),t.clickLog("maskguide_hide")}),l("index"),l("menu"),l("tag"),l("act"),l("cart"),l("addrlist"),l("addredit"),l("confirm"),l("verify"),l("mine"),l("coupon"),h("cart"),h("addr"),h("detail"),s.init(),u.initGPS(),$("#mod-container").delegate(".view-link",$.tapClick,function(){var t=$(this).data("link"),i=$(this).attr("disabled");""!==i&&"true"!==i&&s.changeView(t)}),$.stopPageScroll(),$.isWeixin&&(a.init(),a.setShareCallback(f))},y=function(t,i){return $.formatString(c.product,t,{opHidden:i?'style="visibility:hidden"':"",attributeStr:b(t)})},b=function(t){var i,e;if((i=t.attribute)||(e=t.specifics)){var n=[];return i&&n.push(i),e&&n.push(e),"/"+n.join("&nbsp;")}return""},w=function(i){o.isFirst(i)&&($("#mod-guide-mask").css("display","block"),$("#mod-guide-img")[0].className="img-"+i,t.clickLog("maskguide_show",{key:i}))},C=function(t){return p.isLogin()?(t&&t(),void 0):(s.changeView("verify",[t,s.getCurViewName()]),void 0)};return{init:v,needVerified:C,getAttrStr:b,checkWelcomeLogoCache:m,formatCartProduct:y,showMaskGuide:w,getShoppingCart:function(){return i},getAddrMgr:function(){return u},getUser:function(){return p},selectAddress:function(t){C(function(){s.changeView(u.getAddrCount()?"addrlist":"addredit",[t])})},isProductRestock:function(t){return parseInt(t.number)<1&&!parseInt(t.hot_degree)}}}),/*!File[phone/index/boot.js]*/
$(function(){Bee.boot(["phone/index/main"],function(t){t.init()})});